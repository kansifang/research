<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
</head>

<body>

 <div style="position:relative; left:123px; top:240px;">
  <div id="d" style="position:absolute; left:100px; top:200px; width:50px; height:50px; background:#FF0;"></div>
 </div>

<script language="javascript">
function getStyle(el, style) {
	var value = el.style[style];
	if (!value && el.currentStyle) {
		value = el.currentStyle[style];
	}
	if (!value || value === 'auto') {
		var css = document.defaultView.getComputedStyle(el, null);
		value = css ? css[style] : null;
	}
	return (value === 'auto' ? null : value);
}
function  getViewportOffset(element) {
	var top = 0,
		left = 0,
		el = element,
		docBody = document.body;

	do {
		top += el.offsetTop || 0;
		left += el.offsetLeft || 0;
		//如果是绝对定位
		if (el.offsetParent === docBody && getStyle(el, 'position') === 'absolute') {
			break;
		}
		//如果位置为fixed
		if (getStyle(el, 'position') === 'fixed') {
			top += docBody.scrollTop || 0;
			left += docBody.scrollLeft || 0;
			break;
		}
		//获取上一级相对偏移
		el = el.offsetParent;
	} while (el);

	el = element;

	do {
		if (el === docBody) {//直到到达Body节点
			break;
		}

		top -= el.scrollTop || 0;
		left -= el.scrollLeft || 0;

		el = el.parentNode;
	} while (el);
	//返回当前容器相对于窗体的坐标
	console.log(left, top);
}
getViewportOffset(document.getElementById("d"));
</script>
</body>
</html>
